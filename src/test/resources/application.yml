spring:
  jpa:
    hibernate:
      ddl-auto: validate  # Flyway manages schema in tests too
    show-sql: true

  flyway:
    enabled: true
    locations: classpath:db/migration
    validate-on-migrate: true

  data:
    redis:
      host: localhost
      port: 6379

  cache:
    type: none  # Disable Redis cache in tests

  # Task execution configuration for tests - disable wait on shutdown to prevent hanging
  task:
    execution:
      shutdown:
        await-termination: false
    scheduling:
      shutdown:
        await-termination: false

  # Spring Modulith configuration for tests
  modulith:
    events:
      completion-mode: delete  # Clean up completed events immediately
      republish-outstanding-events-on-restart: false  # Don't republish on test restart

  # HikariCP configuration for tests - fast failure to prevent 30s hangs on shutdown
  datasource:
    hikari:
      connection-timeout: 1000  # 1 second instead of default 30 seconds
      validation-timeout: 1000  # 1 second validation timeout
      initialization-fail-timeout: 0  # Fail fast if pool can't initialize

currency-service:
  exchange-rate-import:
    import-on-startup: false  # Disable startup import in tests
    fred:
      base-url: http://localhost:8080/mock-fred
      api-key: test-key
    retry:
      max-attempts: 1
      delay-minutes: 1  # Minimum allowed value
